<div class="container">
    {{> message}}


    {{#if messages}}
    <a href="/im" class="btn btn-primary">Back</a>
    {{!-- loading in a specific conversation --}}
    <h4>Chat with {{other_user.first_name}} {{other_user.last_name}} ({{other_user.username}})</h4>
    <div class="container border" id="messages-container" style="height: 70vh; overflow-y: auto;">
        {{#each messages}}
        {{#if new_date}}
        <p class="date-separator text-center">{{date}}</p>
        {{/if}}
        <div class="message d-inline-block {{#if received}} received{{else}} sent{{/if}}">
            <p class="date">{{time}}</p>
            <p>{{message_text}}</p>
        </div>
        {{/each}}
    </div>
    <form action="/im" method="POST" class="mt-3">
        <div class="form-group d-flex">
            <input type="text" name="message" class="form-control me-2" placeholder="Type here" required>
            <input type="hidden" name="conv_id" value="{{conv_id}}">
            <button type="submit" class="btn btn-primary">Send</button>
        </div>
    </form>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const container = document.getElementById("messages-container");
            container.scrollTop = container.scrollHeight;
        });
    </script>

    {{else}}
    {{#if conversations}}
    {{!-- we load in conversations for them to select --}}
    <h4>Select a Conversation</h4>
    <table class="table">
        <tbody>
            {{#each conversations}}
            <tr>
                <td>
                    {{first_name}} {{last_name}} ({{username}})
                    {{#if current_unread}}
                    <span class="notification-symbol"></span>
                    {{/if}}
                </td>

                <td>
                    <a href="/im?conv_id={{conversation_id}}" class="btn btn-primary">Chat</a>
                </td>
            </tr>
            {{/each}}
        </tbody>
    </table>

    {{else}}
    {{!-- they have no conversations --}}
    <p>No conversations, Go make some!</p>
    {{/if}}

    {{!-- TODO: add in a way to start a new chat based on username --}}
    {{/if}}
</div>